#INFO: **** input file is /home/liwei01/wsr/dftpart/test_2body/beta/eda_sub2.py ****
from dftpart import scfeda
import numpy as np

frg = [[1,2,3,4,5,6,7,8,9,10,28,29,51,52,53,54,55,56,57,58],
    [11,12,13,14,15,16,17,18,19,20,30,31,43,44,45,46,47,48,49,50],
    [21,22,23,24,25,26,27,32,39,40,41,42,70,71],
    [33,34,35,36,37,38,59,60,61,62,63,64,65,66,67,68,69]]
cen_intot1 = [1, 2, 3, 5, 6, 7, 8, 10, 51, 55, 33, 35, 36, 37, 59, 63, 66, 4, 9, 28, 29, 34, 38, 52, 53, 54, 56, 57, 58, 60, 61, 62, 64, 65, 67, 68, 69]
cen_insub1 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 21, 22, 23, 24, 25, 26, 27, 28, 29, 33, 34, 37, 38, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58]
cen_intot2 = [11, 12, 13, 15, 16, 17, 18, 20, 43, 47, 21, 22, 23, 25, 26, 27, 39, 70, 14, 19, 24, 30, 31, 32, 40, 41, 42, 44, 45, 46, 48, 49, 50, 71]
cen_insub2 = [11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 31, 32, 33, 36, 37, 38, 40, 41, 42, 43, 44, 45, 46, 47, 48, 55]
molchgs1 = np.zeros((58))
molchgs2 = np.zeros((55))

tot2sub = {}
for i in range(len(cen_intot1)):
    tot2sub[cen_intot1[i]] = cen_insub1[i]
for i in range(len(cen_intot2)):
    tot2sub[cen_intot2[i]] = cen_insub2[i]

#test1 = scfeda.EDA()
#test1.gjf = 'beta_subsys/beta_1.gjf'
#test1.method = ['hf','6-31gss', 'charge']
#test1.output = 'beta_1'
##test1.cart = False
##test1.build()
#test1.molchgs = molchgs1
#test1.showinter=True
#atm_E1, totE1, conv1, inter_terms1 = test1.kernel()        
#RR1a, RR2a, RR3a, RR4a, bg2, bg3 = inter_terms1

test2 = scfeda.EDA()
test2.gjf = 'beta_subsys/beta_2.gjf'
test2.method = ['hf','6-31gss','charge']
test2.output = 'beta_2'
#test1.cart = False
#test1.build()
test2.molchgs = molchgs2
test2.showinter=True
atm_E2, totE2, conv2, inter_terms2 = test2.kernel()
RR1b, RR2b, RR3b, RR4b, bg2, bg3 = inter_terms2

# sub1: [1,4] [2]
# sub2: [2,3] [1]

E1a = np.zeros((4))
E1b = np.zeros((4))
E2a = np.zeros((4,4))
E2b = np.zeros((4,4))
#E3 = np.zeros((4,4,4))
#E4 = np.zeros((4,4,4,4))
#E3 = RR3a#,RR3b]
#E4 = RR4a#,RR4b]
E3b = RR3b
E4b = RR4b


t = {
3: 0, 0: 1, 1: 2, 2: 3
}
    
#for f in [0,3]:
#    for i in frg[f]:
#        ff = t[f]
#        ii = tot2sub[i] 
#        E1a[ff] += RR1a[ii-1]
for f in [1,2]:
    for i in frg[f]:
        ff = t[f]
        ii = tot2sub[i] 
        E1b[ff] += RR1b[ii-1]


#for f1 in [3,0,1]:
#    for f2 in [3, 0,1]:
#        if f2 == f1: 
#            for i in frg[f1]:
#                for j in frg[f2]:
#                    ii = tot2sub[i]
#                    jj = tot2sub[j]
#                    ff1 = t[f1]
#                    if ii < jj:
#                        E1a[ff1] += RR2a[ii-1,jj-1]
#                    else:
#                        E1a[ff1] += RR2a[jj-1,ii-1]
#        else:
#            for i in frg[f1]:
#                for j in frg[f2]:
#                    ii = tot2sub[i]
#                    jj = tot2sub[j]
#                    ff1 = t[f1]
#                    ff2 = t[f2]
#                    if ii < jj:
#                        E2a[ff1,ff2] += RR2a[ii-1,jj-1]
#                    else:
#                        E2a[ff1,ff2] += RR2a[jj-1,ii-1]
for f1 in [0,1,2]:
    for f2 in [0,1,2]:
        if f2 == f1: 
            for i in frg[f1]:
                for j in frg[f2]:
                    ii = tot2sub[i]
                    jj = tot2sub[j]
                    ff1 = t[f1]
                    if ii < jj:
                        E1b[ff1] += RR2b[ii-1,jj-1]
                    else:
                        E1b[ff1] += RR2b[jj-1,ii-1]
        else:
            for i in frg[f1]:
                for j in frg[f2]:
                    ii = tot2sub[i]
                    jj = tot2sub[j]
                    ff1 = t[f1]
                    ff2 = t[f2]
                    if ii < jj:
                        E2b[ff1,ff2] += RR2b[ii-1,jj-1]
                    else:
                        E2b[ff1,ff2] += RR2b[jj-1,ii-1]

#print(E1a)
print(E1b)
#print(E2a)
print(E2b)
print(E3b)
print(E4b)
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='master', release='3.10.0-693.el7.x86_64', version='#1 SMP Tue Aug 22 21:09:27 UTC 2017', machine='x86_64', processor='x86_64')  Threads 20
Python 3.6.4 |Anaconda, Inc.| (default, Jan 16 2018, 18:10:19) 
[GCC 7.2.0]
numpy 1.14.0  scipy 1.0.0
Date: Thu Feb 27 22:01:30 2020
PySCF version 1.6.1
PySCF path  /home/liwei01/zcheng/pyscf/pyscf
GIT HEAD      ref: refs/heads/master
GIT master branch  3adc7fd25839fe674469a52b764c3661e32d7318

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 55
[INPUT] num. electrons = 214
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT]  1 C    -28.920111030000  -0.109570750000   0.408427110000 AA  -54.651089338713  -0.207058708763   0.771815379748 Bohr
[INPUT]  2 O    -28.950711060000  -0.892729380000   1.392941890000 AA  -54.708915014817  -1.687014031553   2.632278679534 Bohr
[INPUT]  3 N    -27.797561930000   0.022480950000  -0.306761270000 AA  -52.529778978336   0.042482838520  -0.579694785924 Bohr
[INPUT]  4 C    -26.598606480000  -0.745745670000   0.057770730000 AA  -50.264081542282  -1.409255074880   0.109170857716 Bohr
[INPUT]  5 C    -25.340848590000   0.050796840000  -0.335440780000 AA  -47.887263599171   0.095992115593  -0.633891205210 Bohr
[INPUT]  6 O    -25.374537530000   0.833477820000  -1.320246880000 AA  -47.950926469198   1.575044810700  -2.494905020012 Bohr
[INPUT]  7 N    -24.212660430000  -0.088516480000   0.369510110000 AA  -45.755296959794  -0.167271904711   0.698272908158 Bohr
[INPUT]  8 C    -23.014004340000   0.675290950000  -0.005131830000 AA  -43.490165232152   1.276114949897  -0.009697753218 Bohr
[INPUT]  9 C    -23.010894090000   2.022792080000   0.740370590000 AA  -43.484287711473   3.822523038139   1.399097645783 Bohr
[INPUT] 10 C    -26.606404760000  -2.094047750000  -0.686251870000 AA  -50.278818155724  -3.957176739262  -1.296828086771 Bohr
[INPUT] 11 C    -21.754647470000  -0.124671670000   0.375896940000 AA  -41.110325654762  -0.235595311792   0.710342267662 Bohr
[INPUT] 12 O    -21.780778660000  -0.908886830000   1.359730610000 AA  -41.159706447171  -1.717547186924   2.569518456088 Bohr
[INPUT] 13 N    -20.632814000000   0.014707980000  -0.339145680000 AA  -38.990367639092   0.027794054046  -0.640892451529 Bohr
[INPUT] 14 C    -19.429167580000  -0.746117790000   0.025580190000 AA  -36.715805554479  -1.409958279766   0.048339553314 Bohr
[INPUT] 15 C    -18.175880330000   0.058417130000  -0.366338780000 AA  -34.347435896569   0.110392376683  -0.692279963007 Bohr
[INPUT] 16 O    -18.213071120000   0.840796340000  -1.351228050000 AA  -34.417716304025   1.588874809137  -2.553450946330 Bohr
[INPUT] 17 N    -17.047892030000  -0.073972810000   0.340368620000 AA  -32.215846937856  -0.139788351564   0.643203473196 Bohr
[INPUT] 18 C    -15.852661120000   0.696599260000  -0.031742890000 AA  -29.957187862341   1.316381819975  -0.059985368502 Bohr
[INPUT] 19 C    -15.858912610000   2.044421390000   0.713194590000 AA  -29.969001466311   3.863396510303   1.347742448621 Bohr
[INPUT] 20 C    -19.428198800000  -2.094142990000  -0.719021080000 AA  -36.713974825604  -3.957356716778  -1.358752918989 Bohr
[INPUT] 21 C    -14.589935540000  -0.096501520000   0.353006640000 AA  -27.570982345658  -0.182361443404   0.667085869753 Bohr
[INPUT] 22 O    -14.615160270000  -0.881088620000   1.336541580000 AA  -27.618650176924  -1.665016183271   2.525697540293 Bohr
[INPUT] 23 N    -13.466256970000   0.048825600000  -0.358135010000 AA  -25.447537596315   0.092267011868  -0.676777084518 Bohr
[INPUT] 24 C    -12.260607560000  -0.707723580000   0.009336550000 AA  -23.169190409172  -1.337403738097   0.017643522448 Bohr
[INPUT] 25 C    -11.008969580000   0.101886770000  -0.377239030000 AA  -20.803937419868   0.192538091017  -0.712878450197 Bohr
[INPUT] 26 O    -11.046095600000   0.886855840000  -1.360128070000 AA  -20.874095429763   1.675914649571  -2.570269546633 Bohr
[INPUT] 27 C    -12.251926190000  -2.054347480000  -0.737724700000 AA  -23.152784997486  -3.882154101890  -1.394097638327 Bohr
[INPUT] 28 O     -9.912954450000  -0.025742760000   0.312544150000 AA  -18.732768995788  -0.048646766090   0.590622845335 Bohr
[INPUT] 29 H    -27.773911090000   0.644220920000  -1.089624060000 AA  -52.485085368120   1.217401102515  -2.059091052137 Bohr
[INPUT] 30 H    -24.184792710000  -0.711669510000   1.151110050000 AA  -45.702634601278  -1.344860465103   2.175282733734 Bohr
[INPUT] 31 H    -20.612936100000   0.636844800000  -1.121814250000 AA  -38.952803852160   1.203462255853  -2.119921695134 Bohr
[INPUT] 32 H    -17.017825430000  -0.696874980000   1.122050730000 AA  -32.159029298359  -1.316902855262   2.120368577568 Bohr
[INPUT] 33 H    -13.446356330000   0.672297800000  -1.139713130000 AA  -25.409930837012   1.270458716148  -2.153745676271 Bohr
[INPUT] 34 H    -26.594407330000  -0.920996050000   1.113347260000 AA  -50.256146298826  -1.740430296306   2.103921402935 Bohr
[INPUT] 35 H    -23.018767620000   0.851409860000  -1.060516680000 AA  -43.499166526806   1.608931455154  -2.004086075733 Bohr
[INPUT] 36 H    -19.424531100000  -0.921751300000   1.081037230000 AA  -36.707043877097  -1.741857511962   2.042864295158 Bohr
[INPUT] 37 H    -15.855739060000   0.872403440000  -1.087205980000 AA  -29.963004325969   1.648603571728  -2.054521543189 Bohr
[INPUT] 38 H    -12.258706360000  -0.885174460000   1.064518740000 AA  -23.165597661864  -1.672737301860   2.011648873067 Bohr
[INPUT] 39 H    -29.792045780000   0.451044740000   0.143210100000 AA  -56.298807214704   0.852351028526   0.270627867272 Bohr
[INPUT] 40 H    -13.121560440000  -2.616882950000  -0.469112760000 AA  -24.796155558527  -4.945192075544  -0.886494637939 Bohr
[INPUT] 41 H    -11.374326610000  -2.604944020000  -0.470265160000 AA  -21.494362144253  -4.922630767624  -0.888672358325 Bohr
[INPUT] 42 H    -12.253823950000  -1.876855060000  -1.792896960000 AA  -23.156371244136  -3.546742038904  -3.388084223965 Bohr
[INPUT] 43 H    -16.736251280000   2.595555900000   0.445902080000 AA  -31.626931271101   4.904889791999   0.842632809574 Bohr
[INPUT] 44 H    -14.988984930000   2.605551860000   0.442608720000 AA  -28.325076402933   4.923779418751   0.836409261144 Bohr
[INPUT] 45 H    -15.855922100000   1.868614260000   1.768639820000 AA  -29.963350221439   3.531169183857   3.342244872800 Bohr
[INPUT] 46 H    -20.299204580000  -2.652729940000  -0.446538790000 AA  -38.359937202717  -5.012933069034  -0.843836017095 Bohr
[INPUT] 47 H    -18.551924290000  -2.647751150000  -0.453376360000 AA  -35.058055991766  -5.003524519502  -0.856757151752 Bohr
[INPUT] 48 H    -19.432823000000  -1.918590110000  -1.774505350000 AA  -36.722713297149  -3.625609853199  -3.353329118075 Bohr
[INPUT] 49 H    -23.885884430000   2.578842260000   0.475622530000 AA  -45.137779815713   4.873305589854   0.898796320373 Bohr
[INPUT] 50 H    -22.138605630000   2.579259960000   0.467736470000 AA  -41.835901420454   4.874094928457   0.883893826771 Bohr
[INPUT] 51 H    -23.006084640000   1.846525520000   1.795751770000 AA  -43.475199168163   3.489427514820   3.393479033003 Bohr
[INPUT] 52 H    -27.480621710000  -2.647179840000  -0.412949210000 AA  -51.930848764677  -5.002444900070  -0.780360910256 Bohr
[INPUT] 53 H    -25.733347790000  -2.652871910000  -0.420945040000 AA  -48.628979591282  -5.013201353452  -0.795470839094 Bohr
[INPUT] 54 H    -26.610664870000  -1.918884680000  -1.741796320000 AA  -50.286868596885  -3.626166509824  -3.291518009575 Bohr
[INPUT] 55 H     -9.132680890000   0.479060530000   0.071696340000 AA  -17.258265665149   0.905293198789   0.135486446734 Bohr

nuclear repulsion = 2528.50709220092
number of shells = 249
number of NR pGTOs = 945
number of NR cGTOs = 527
basis = 6-31gss
ecp = {}
CPU time:         1.10


******** <class 'pyscf.qmmm.itrf.mm_charge.<locals>.QMMM'> ********
method = QMMM-RHF
initial guess = minao
damping factor = 0
level shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
DIIS start cycle = 1
DIIS space = 8
SCF tol = 1e-09
SCF gradient tol = None
max. SCF cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/liwei01/wsr/dftpart/test_2body/beta/tmpgnxscuwu
max_memory 4000 MB (current use 67 MB)
** Add background charges for <class 'pyscf.scf.hf.RHF'> **
Set gradient conv threshold to 3.16228e-05
init E= -1425.98367093028
  HOMO = -0.320204885190545  LUMO = -0.0350169512240266
cycle= 1 E= -1417.25386445603  delta_E= 8.73  |g|= 1.86  |ddm|= 7.09
  HOMO = -0.337158677469439  LUMO = 0.0668736158843986
cycle= 2 E= -1417.66460803813  delta_E= -0.411  |g|= 1.47  |ddm|= 2.79
  HOMO = -0.426942675954343  LUMO = 0.113345087361907
cycle= 3 E= -1418.07460330726  delta_E= -0.41  |g|= 0.18  |ddm|= 1.31
  HOMO = -0.426962614946679  LUMO = 0.121588993908301
cycle= 4 E= -1418.08637980446  delta_E= -0.0118  |g|= 0.0489  |ddm|= 0.26
  HOMO = -0.428501481369965  LUMO = 0.120450221095282
cycle= 5 E= -1418.08728432722  delta_E= -0.000905  |g|= 0.0195  |ddm|= 0.077
  HOMO = -0.428370196172434  LUMO = 0.120196693820341
cycle= 6 E= -1418.0875392066  delta_E= -0.000255  |g|= 0.00856  |ddm|= 0.0446
  HOMO = -0.428086437649016  LUMO = 0.12034664438264
cycle= 7 E= -1418.08759692276  delta_E= -5.77e-05  |g|= 0.00316  |ddm|= 0.0248
  HOMO = -0.428171066427536  LUMO = 0.120303276856512
cycle= 8 E= -1418.08760297231  delta_E= -6.05e-06  |g|= 0.00106  |ddm|= 0.00783
  HOMO = -0.428149624510448  LUMO = 0.120286359705906
cycle= 9 E= -1418.08760356218  delta_E= -5.9e-07  |g|= 0.000442  |ddm|= 0.00208
  HOMO = -0.4281273248026  LUMO = 0.12029489886937
cycle= 10 E= -1418.0876036417  delta_E= -7.95e-08  |g|= 0.000146  |ddm|= 0.000669
  HOMO = -0.428126658723999  LUMO = 0.120292458570989
cycle= 11 E= -1418.08760365204  delta_E= -1.03e-08  |g|= 4.14e-05  |ddm|= 0.000237
  HOMO = -0.428127099843  LUMO = 0.120292249093675
cycle= 12 E= -1418.08760365294  delta_E= -8.94e-10  |g|= 1.41e-05  |ddm|= 7.48e-05
  HOMO = -0.428125638524125  LUMO = 0.120292872519831
Extra cycle  E= -1418.087603653  delta_E= -5.96e-11  |g|= 9.08e-06  |ddm|= 2.09e-05
converged SCF energy = -1418.087603653
